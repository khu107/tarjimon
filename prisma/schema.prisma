generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// ===== Enums =====

// ì‚¬ìš©ì ì—­í• 
enum Role {
  USER          // ì¼ë°˜ ì‚¬ìš©ì
  INTERPRETER   // í†µì—­ì‚¬
  ADMIN         // ê´€ë¦¬ì
}

// ì‚¬ìš©ì ìƒíƒœ
enum UserStatus {
  ACTIVE        // í™œì„±
  PENDING       // ëŒ€ê¸° ì¤‘
  SUSPENDED     // ì •ì§€
  DELETED       // ì‚­ì œë¨ (soft delete)
}

// ì¸ì¦ ì œê³µì (ë¡œê·¸ì¸ ë°©ì‹)
enum AuthProvider {
  SMS           // SMS ì¸ì¦
}

// í†µì—­ì‚¬ ìŠ¹ì¸ ìƒíƒœ
enum InterpreterStatus {
  PENDING_APPROVAL   // ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸°
  APPROVED           // ìŠ¹ì¸ë¨
  REJECTED           // ê±°ì ˆë¨
}

// SMS ì¸ì¦ ëª©ì 
enum SmsVerificationPurpose {
  LOGIN           // ë¡œê·¸ì¸
  PASSWORD_RESET  // ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
}

// ğŸ†• ì•± ì–¸ì–´
enum AppLanguage {
  UZ    // ìš°ì¦ˆë²¡ì–´
  RU    // ëŸ¬ì‹œì•„ì–´
  EN    // ì˜ì–´
}


// ===== Models =====

model User {
  id            String       @id @default(uuid())
  role          Role         @default(USER)
  phone         String?      @unique
  authProvider  AuthProvider
  status        UserStatus   @default(PENDING)
  tokenVersion  Int          @default(0)
  appLanguage   AppLanguage  @default(EN)  
  
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  deletedAt     DateTime?    // soft deleteìš©

  // Relations
  userProfile   UserProfile?  // 1:1 ê´€ê³„
  interpreter   Interpreter?  // 1:1 ê´€ê³„
  refreshTokens RefreshToken[]

  @@map("users")
}

model UserProfile {
  id          String    @id @default(uuid())
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  avatarUrl   String?
  nationality String?
  preferences Json?     // ì‚¬ìš©ì ì„¤ì • (ì–¸ì–´, ì•Œë¦¼ ë“±)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("user_profiles")
}

model SmsVerification {
  id          String                    @id @default(uuid())
  phone       String
  code        String                    // 6ìë¦¬ ì¸ì¦ ì½”ë“œ
  purpose     SmsVerificationPurpose    @default(LOGIN)
  expiresAt   DateTime
  createdAt   DateTime                  @default(now())

  @@map("sms_verifications")
}

model RefreshToken {
  id          String    @id @default(uuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  token       String    @unique  // í•´ì‹œëœ í† í°
  expiresAt   DateTime
  deviceInfo  String?
  ipAddress   String?
  isRevoked   Boolean   @default(false)
  createdAt   DateTime  @default(now())

  @@map("refresh_tokens")
}

// ===== Interpreter Models =====

// ë§ˆìŠ¤í„° ë°ì´í„°: ì–¸ì–´ (ë‹¤êµ­ì–´ ì§€ì›)
model Language {
  id          String    @id @default(uuid())
  code        String    @unique  // "ko", "en", "uz"
  nameUz      String   
  nameRu      String    
  nameEn      String    
  
  interpreters InterpreterLanguage[]
  @@map("languages")
}

// ì¤‘ê°„ í…Œì´ë¸”: í†µì—­ì‚¬ - ì–¸ì–´ (ë‹¤ëŒ€ë‹¤)
model InterpreterLanguage {
  id              String    @id @default(uuid())
  interpreterId   String
  interpreter     Interpreter @relation(fields: [interpreterId], references: [id], onDelete: Cascade)
  languageId      String
  language        Language  @relation(fields: [languageId], references: [id])
  
  @@unique([interpreterId, languageId])
  @@map("interpreter_languages")
}

// ë§ˆìŠ¤í„° ë°ì´í„°: ì „ë¬¸ë¶„ì•¼ (ë‹¤êµ­ì–´ ì§€ì›)
model Specialization {
  id          String    @id @default(uuid())
  nameUz      String    
  nameRu      String    
  nameEn      String    
  
  interpreters InterpreterSpecialization[]
  @@map("specializations")
}

// ì¤‘ê°„ í…Œì´ë¸”: í†µì—­ì‚¬ - ì „ë¬¸ë¶„ì•¼ (ë‹¤ëŒ€ë‹¤)
model InterpreterSpecialization {
  id              String    @id @default(uuid())
  interpreterId   String
  interpreter     Interpreter @relation(fields: [interpreterId], references: [id], onDelete: Cascade)
  specializationId String
  specialization  Specialization @relation(fields: [specializationId], references: [id])
  
  @@unique([interpreterId, specializationId])
  @@map("interpreter_specializations")
}

// ìê²©ì¦ (1:N ê´€ê³„)
model Certification {
  id              String    @id @default(uuid())
  interpreterId   String
  interpreter     Interpreter @relation(fields: [interpreterId], references: [id], onDelete: Cascade)
  name            String
  issuer          String?
  issueDate       DateTime
  expiryDate      DateTime?
  documentUrl     String?
  
  createdAt       DateTime  @default(now())
  @@map("certifications")
}

// í†µì—­ì‚¬ í”„ë¡œí•„
model Interpreter {
  id                String    @id @default(uuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name              String?
  bio               String?   @db.Text
  avatarUrl         String?
  nationality       String?
  yearsOfExperience Int?
  currentLocation   String?
  
  status            InterpreterStatus @default(PENDING_APPROVAL)
  onlineStatus      Boolean   @default(false)
  
  averageRating     Float?    @default(0)
  totalReviews      Int       @default(0)
  
  // Relations (ë‹¤ëŒ€ë‹¤)
  languages         InterpreterLanguage[]
  specializations   InterpreterSpecialization[]
  certifications    Certification[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  @@map("interpreters")
}